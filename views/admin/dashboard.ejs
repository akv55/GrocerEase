<% layout("/layouts/adminboilerplate") -%>
  <!-- Main Dashboard Content -->
  <div class="admin-dashboard">
    <div class="dashboard-header">
      <h2>Admin Dashboard</h2>
      <p>Welcome to GrocerEase Admin Panel</p>
    </div>
    <!-- Dashboard Statistics -->
    <div class="dashboard-stats">
      <div class="stat-card">
        <h3>
          <%= users.length %>
        </h3>
        <p>Total Users</p>
      </div>
      <div class="stat-card">
        <h3>
          <%= products.length %>
        </h3>
        <p>Total Products</p>
      </div>
      <div class="stat-card">
        <h3>
          <%= orders.length %>
        </h3>
        <p>Total Orders</p>
      </div>
      <div class="stat-card">
        <h3>â‚¹<%= totalRevenue.toFixed(2) %>
        </h3>
        <p>Total Revenue</p>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="dashboard-charts">
      <div class="chart-container">
        <h3>Sales Overview</h3>
        <canvas id="salesChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Product Categories</h3>
        <canvas id="categoryChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Order Status</h3>
        <canvas id="orderChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Monthly Revenue</h3>
        <canvas id="revenueChart"></canvas>
      </div>
    </div>
    <!-- Additional Charts Section -->
    <div class="dashboard-charts">
      <div class="chart-container">
        <h3>Payment Methods</h3>
        <canvas id="paymentMethodChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Payment Status</h3>
        <canvas id="paymentStatusChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Top Selling Products</h3>
        <canvas id="topProductsChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>User Registrations</h3>
        <canvas id="userRegistrationChart"></canvas>
      </div>
    </div>
    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2>Quick Actions</h2>
      <div class="action-buttons">
        <a href="/admin/products/new-product" class="btn btn-primary">Add New Product</a>
        <a href="/admin/orders" class="btn btn-secondary">View Orders</a>
      </div>
    </div>
  </div>




  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Dashboard Charts JavaScript -->
  <script>
    // Chart colors
    const chartColors = {
      primary: '#4F46E5',
      secondary: '#10B981',
      warning: '#F59E0B',
      danger: '#EF4444',
      info: '#06B6D4',
      purple: '#8B5CF6'
    };
    // -------------------SALES LINE CHART-------------------
    const monthlyRevenue = <%-monthlyRevenue %>;
     const salesCtx = document.getElementById('salesChart').getContext('2d');
    new Chart(salesCtx, {
      type: 'line',
      data: {
        labels: Object.keys(monthlyRevenue),
        datasets: [{
          label: 'Monthly Sales',
          data: Object.values(monthlyRevenue),
          borderColor: chartColors.primary,
          backgroundColor: chartColors.primary + '20',
          borderWidth: 2,
          fill: true,
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '$' + value.toFixed(0);
              }
            }
          }
        }
      }
    });
    // -------------------CATEGORY PIE CHARTS-----------------
      const categoryData = <%- categoryData %>;
      const categoryCtx = document.getElementById('categoryChart').getContext('2d');
      new Chart(categoryCtx, {
        type: 'pie',
        data: {
          labels: Object.keys(categoryData),
          datasets: [{
            label: 'Products',
            data: Object.values(categoryData),
            backgroundColor: [
              chartColors.primary,
              chartColors.secondary,
              chartColors.warning,
              chartColors.danger,
              chartColors.info,
              chartColors.purple
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top'
            }
          }
        }
      });

    // --------------------ORDERS STATUS BAR CHART--------------------
    const orderStatusData = <%- orderStatusData %>;
    if (Object.keys(orderStatusData).length > 0) {
      const orderCtx = document.getElementById('orderChart').getContext('2d');
      new Chart(orderCtx, {
        type: 'bar',
        data: {
          labels: Object.keys(orderStatusData),
          datasets: [{
            label: 'Orders',
            data: Object.values(orderStatusData),
            backgroundColor: [
              chartColors.warning,
              chartColors.info,
              chartColors.primary,
              chartColors.secondary,
              chartColors.danger
            ],
            borderWidth: 1,
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    } else {
      // If no data, show a message
      document.getElementById('orderChart').parentElement.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No order data available</div>';
    }

    // -------------------MONTHLY REVENUE BAR CHART-------------------
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
      type: 'bar',
      data: {
        labels: Object.keys(monthlyRevenue),
        datasets: [{
          label: 'Revenue ($)',
          data: Object.values(monthlyRevenue),
          backgroundColor: chartColors.secondary,
          borderColor: chartColors.secondary,
          borderWidth: 1,
          borderRadius: 4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '$' + value.toFixed(0);
              }
            }
          }
        }
      }
    });

    // -------------------PAYMENT METHODS PIE CHART-------------------
    const paymentMethodData = <%- paymentMethodData %>;
    if (Object.keys(paymentMethodData).length > 0) {
      const paymentMethodCtx = document.getElementById('paymentMethodChart').getContext('2d');
      new Chart(paymentMethodCtx, {
        type: 'pie',
        data: {
          labels: Object.keys(paymentMethodData),
          datasets: [{
            label: 'Orders',
            data: Object.values(paymentMethodData),
            backgroundColor: [
              chartColors.primary,
              chartColors.secondary,
              chartColors.warning,
              chartColors.danger
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top'
            }
          }
        }
      });
    } else {
      document.getElementById('paymentMethodChart').parentElement.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No payment method data available</div>';
    }

    // -------------------PAYMENT STATUS BAR CHART-------------------
    const paymentStatusData = <%- paymentStatusData %>;
    if (Object.keys(paymentStatusData).length > 0) {
      const paymentStatusCtx = document.getElementById('paymentStatusChart').getContext('2d');
      new Chart(paymentStatusCtx, {
        type: 'bar',
        data: {
          labels: Object.keys(paymentStatusData),
          datasets: [{
            label: 'Payments',
            data: Object.values(paymentStatusData),
            backgroundColor: [
              chartColors.warning,
              chartColors.secondary,
              chartColors.danger
            ],
            borderWidth: 1,
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    } else {
      document.getElementById('paymentStatusChart').parentElement.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No payment status data available</div>';
    }

    // -------------------TOP SELLING PRODUCTS HORIZONTAL BAR CHART-------------------
    const topProductsData = <%- topProductsData %>;
    if (Object.keys(topProductsData).length > 0) {
      const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
      new Chart(topProductsCtx, {
        type: 'bar',
        data: {
          labels: Object.keys(topProductsData),
          datasets: [{
            label: 'Units Sold',
            data: Object.values(topProductsData),
            backgroundColor: chartColors.purple,
            borderColor: chartColors.purple,
            borderWidth: 1,
            borderRadius: 4
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    } else {
      document.getElementById('topProductsChart').parentElement.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No product sales data available</div>';
    }

    // -------------------USER REGISTRATIONS LINE CHART-------------------
    const userRegistrationData = <%- userRegistrationData %>;
    const userRegCtx = document.getElementById('userRegistrationChart').getContext('2d');
    new Chart(userRegCtx, {
      type: 'line',
      data: {
        labels: Object.keys(userRegistrationData),
        datasets: [{
          label: 'New Users',
          data: Object.values(userRegistrationData),
          borderColor: chartColors.info,
          backgroundColor: chartColors.info + '20',
          borderWidth: 2,
          fill: true,
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 1
            }
          }
        }
      }
    });
    
  </script>